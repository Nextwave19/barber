<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>× ×™×”×•×œ HairBoss</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hour-block {
            transition: background-color 0.3s ease, transform 0.2s ease;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            width: fit-content;
            margin: 0.25rem auto;
        }
        .hour-block:hover {
            background-color: #c6f6d5 !important;
            transform: scale(1.02);
        }
        .disabled-hour {
            background-color: #d1d5db !important;
            color: #6b7280;
        }
        .hour-list {
            transition: max-height 0.5s ease-in-out;
        }
        .active-hour {
            background-color: #bbf7d0 !important;
            color: #166534;
        }
        .hour-block .actions button {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
    </style>
</head>
<body class="bg-gray-100 p-6 text-right">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">×œ×•×— × ×™×”×•×œ HairBoss</h1>
        <div class="flex gap-2">
            <form method="GET" action="/logout">
                <button class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500">×”×ª× ×ª×§</button>
            </form>
            <form method="GET" action="/">
                <button class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">×—×–×¨×” ×œ×”×–×× ×•×ª</button>
            </form>
        </div>
    </div>

    <div class="bg-white p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">× ×™×”×•×œ ×ª×•×¨×™×</h2>
        {% for day in free_slots.keys() %}
            <div class="mb-4">
                <div class="flex justify-between items-center bg-gray-100 p-2 rounded cursor-pointer hover:bg-gray-200" onclick="toggleDay('{{ day }}')">
                    <span class="text-lg font-medium">{{ day }}</span>
                    <form method="POST" action="/slot">
                        <input type="hidden" name="date" value="{{ day }}">
                        <input type="hidden" name="time" value="*">
                        <input type="hidden" name="action" value="disable_day">
                        <button class="bg-red-500 text-white px-2 py-1 text-sm rounded hover:bg-red-600">×”×©×‘×ª ××ª ×›×œ ×”×™×•×</button>
                    </form>
                </div>
                <div id="hours-{{ day }}" class="hour-list hidden p-2 border rounded bg-white shadow-inner mt-2">
                    {% for time in free_slots[day] %}
                        <div class="hour-block {{ 'disabled-hour' if free_slots[day][time] == 'disabled' else 'active-hour' }} cursor-pointer text-center rounded" onclick="toggleActions(this)">
                            {{ time }}
                            <div class="actions hidden mt-1 flex gap-2 justify-center">
                                <button onclick="modifySlot('{{ day }}', '{{ time }}', 'delete'); event.stopPropagation();" class="bg-red-500 text-white text-xs rounded hover:bg-red-600">ğŸ—‘ï¸</button>
                                {% if free_slots[day][time] == 'disabled' %}
                                    <button onclick="modifySlot('{{ day }}', '{{ time }}', 'enable'); event.stopPropagation();" class="bg-green-500 text-white text-xs rounded hover:bg-green-600">âœ…</button>
                                {% else %}
                                    <button onclick="modifySlot('{{ day }}', '{{ time }}', 'disable'); event.stopPropagation();" class="bg-gray-500 text-white text-xs rounded hover:bg-gray-600">ğŸš«</button>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}

                    <form method="POST" action="/slot" class="mt-3 flex gap-2 items-center">
                        <input type="hidden" name="date" value="{{ day }}">
                        <input type="text" name="time" placeholder="×”×•×¡×£ ×©×¢×” (×œ××©×œ 14:00)" class="border px-2 py-1 rounded w-40" required>
                        <input type="hidden" name="action" value="add">
                        <button class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">â•</button>
                    </form>
                </div>
            </div>
        {% endfor %}
    </div>

    <div class="bg-white p-6 mt-8 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">×¢×“×›×•×Ÿ ×™×“×¢ ×©×œ ×”×‘×•×˜</h2>
        <form method="POST" action="/bot-knowledge" class="mb-4">
            <label class="block mb-1">ğŸ“ ×”×•×¡×£ ××™×“×¢ ×—×“×©:</label>
            <input type="text" name="content" class="border px-3 py-1 rounded w-1/2" required>
            <input type="hidden" name="action" value="add">
            <button class="bg-green-500 text-white px-4 py-1 rounded hover:bg-green-600 ml-2">×”×•×¡×£</button>
        </form>

        <form method="POST" action="/bot-knowledge" class="mb-4">
            <label class="block mb-1">ğŸ—‘ï¸ ×”×¡×¨ ××™×“×¢:</label>
            <input type="text" name="content" class="border px-3 py-1 rounded w-1/2" required>
            <input type="hidden" name="action" value="remove">
            <button class="bg-red-500 text-white px-4 py-1 rounded hover:bg-red-600 ml-2">×”×¡×¨</button>
        </form>

        <h3 class="font-medium text-gray-700 mt-4">ğŸ“‹ ××™×“×¢ ×§×™×™×:</h3>
        <ul class="list-disc pr-5">
            {% for item in custom_knowledge %}
                <li>{{ item }}</li>
            {% else %}
                <li>××™×Ÿ ××™×“×¢ × ×•×¡×£.</li>
            {% endfor %}
        </ul>
    </div>

    <script>
        function toggleDay(day) {
            const el = document.getElementById("hours-" + day);
            if (el) el.classList.toggle("hidden");
        }

        function toggleActions(hourEl) {
            const actions = hourEl.querySelector('.actions');
            if (actions) {
                actions.classList.toggle('hidden');
            }
        }

        function modifySlot(date, time, action) {
            fetch("/admin/update_slot", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ date, time, action })
            })
            .then(res => res.json())
            .then(data => {
                if (data.status || data.message) {
                    location.reload();
                } else {
                    alert("×©×’×™××”: " + (data.error || "×œ× ×™×“×•×¢×”"));
                }
            });
        }
    </script>
</body>
</html>
