<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>לוח ניהול HairBoss</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        async function toggleDay(day, element) {
            const container = document.getElementById(`slots-${day}`);
            container.classList.toggle('hidden');
            element.innerText = container.classList.contains('hidden') ? 'הצג שעות' : 'הסתר שעות';
        }

        async function updateSlot(date, time, action, button = null) {
            const res = await fetch("/admin/update_slot", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ date, time, action })
            });
            const data = await res.json();

            const btnGroup = document.getElementById(`btns-${date}-${time}`);
            const box = document.getElementById(`box-${date}-${time}`);

            if (data.status === "deleted") {
                box.remove();
            } else if (data.status === "disabled") {
                box.classList.add("bg-gray-300", "text-gray-500");
                box.classList.remove("bg-white");
                renderButtons(date, time, "disabled");
            } else if (data.status === "enabled") {
                box.classList.remove("bg-gray-300", "text-gray-500");
                box.classList.add("bg-white");
                renderButtons(date, time, "enabled");
            }
        }

        function renderButtons(date, time, state) {
            const btns = document.getElementById(`btns-${date}-${time}`);
            if (!btns) return;

            let html = "";
            if (state === "enabled") {
                html += `<button onclick="updateSlot('${date}', '${time}', 'delete')" class="text-red-600">🗑️</button>`;
                html += `<button onclick="updateSlot('${date}', '${time}', 'disable')" class="text-yellow-500">🚫</button>`;
            } else if (state === "disabled") {
                html += `<button onclick="updateSlot('${date}', '${time}', 'enable')" class="text-green-600">✅</button>`;
            }
            btns.innerHTML = html;
        }

        async function addSlot(date) {
            const time = prompt("הכנס שעה בפורמט HH:MM");
            if (!time) return;
            const res = await fetch("/admin/update_slot", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ date, time, action: "add" })
            });
            const data = await res.json();
            if (data.status === "added") location.reload();
        }

        async function editSlot(date, time) {
            const new_time = prompt("שנה את השעה:", time);
            if (!new_time || new_time === time) return;
            const res = await fetch("/admin/update_slot", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ date, time, action: "edit", new_time })
            });
            const data = await res.json();
            if (data.status === "edited") location.reload();
        }
    </script>
</head>
<body class="bg-gray-100 p-6 font-sans">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">לוח ניהול HairBoss</h1>
        <a href="/" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">חזרה להזמנות</a>
    </div>

    {% for day, slots in free_slots.items() %}
    <div class="bg-white rounded shadow p-4 mb-4">
        <div class="flex justify-between items-center mb-2">
            <h2 class="text-xl font-semibold">{{ day }}</h2>
            <div>
                <button onclick="addSlot('{{ day }}')" class="text-green-600 mr-3">➕ הוסף שעה</button>
                <button onclick="toggleDay('{{ day }}', this)" class="text-blue-600">הצג שעות</button>
            </div>
        </div>
        <div id="slots-{{ day }}" class="hidden grid grid-cols-4 gap-2">
            {% for time in slots %}
            <div id="box-{{ day }}-{{ time }}" class="border p-2 rounded bg-white text-center">
                <div class="font-bold">{{ time }}</div>
                <div id="btns-{{ day }}-{{ time }}" class="mt-2 space-x-2">
                    <script>renderButtons("{{ day }}", "{{ time }}", "enabled")</script>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
</body>
</html>
